<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask Connect and Sign Message</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
    <h1>Connect to MetaMask and Sign a Message</h1>

    <input type="text" id="messageInput" placeholder="Enter message to sign">

    <button id="connectButton">Connect MetaMask</button>
    <script>
        document.getElementById('connectButton').addEventListener('click', async function() {
            'use strict';

            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access if needed
                    await window.ethereum.request({ method: 'eth_requestAccounts' });

                    // Initialize web3
                    const web3 = new Web3(window.ethereum);

                    // Check if MetaMask is connected
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length === 0) {
                        console.log('MetaMask is not connected');
                        alert('MetaMask is not connected');
                        return;
                    } else {
                        console.log('MetaMask is connected. Account:', accounts[0]);
                    }

                    const message = document.getElementById('messageInput').value;
                    console.log('Message to sign:', message);
                    if (message) {
                        web3.eth.personal.sign(web3.utils.utf8ToHex(message), accounts[0], '')
                            .then(signature => {
                                console.log('Message signed:', signature);
                                alert('Message signed successfully. Signature: ' + signature);
                            })
                            .catch(error => {
                                console.error('Error signing message:', error);
                                alert('Error signing message: ' + error.message);
                            });
                    } else {
                        console.log('No message entered');
                    }
                } catch (error) {
                    console.error('Error during MetaMask interaction:', error);
                    alert('Error during MetaMask interaction: ' + error.message);
                }
            } else {
                console.log('MetaMask is not installed');
                alert('MetaMask is not installed. Please install it to proceed.');
            }
        });
    </script>
</body>
</html>
